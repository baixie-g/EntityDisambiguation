# 各模型得分总分范围分析

## 📊 各模型得分范围

### 1. BGE-M3向量相似度得分
- **得分范围**: 0.0 - 1.0
- **计算方式**: 余弦相似度
- **说明**: 基于语义向量的相似度，反映实体的语义相似性
- **权重**: 40% (0.4)

### 2. CrossEncoder重排序得分
- **得分范围**: 0.0 - 1.0
- **计算方式**: CrossEncoder模型预测
- **说明**: 基于交叉编码器的精确匹配得分
- **权重**: 30% (0.3)

### 3. RapidFuzz字符串匹配得分
- **得分范围**: 0.0 - 1.0
- **计算方式**: `fuzz.token_sort_ratio() / 100.0`
- **说明**: 基于模糊字符串匹配，处理名称和别名的相似性
- **权重**: 20% (0.2)

### 4. Levenshtein编辑距离得分
- **得分范围**: 0.0 - 1.0
- **计算方式**: `1.0 - (编辑距离 / 最大长度)`
- **说明**: 基于编辑距离的相似度，处理字符级别的相似性
- **权重**: 10% (0.1)

## 🧮 总分计算分析

### 加权得分范围
```
加权得分 = BGE得分×0.4 + CrossEncoder得分×0.3 + Fuzz得分×0.2 + Levenshtein得分×0.1
```

**理论范围**:
- **最小值**: 0.0×0.4 + 0.0×0.3 + 0.0×0.2 + 0.0×0.1 = **0.0**
- **最大值**: 1.0×0.4 + 1.0×0.3 + 1.0×0.2 + 1.0×0.1 = **1.0**

### 最终得分范围（考虑类型匹配）

#### 类型匹配情况
- **倍数**: 1.1
- **最终得分范围**: 0.0 - 1.1

#### 类型不匹配情况
- **倍数**: 0.3
- **最终得分范围**: 0.0 - 0.3

#### 类型信息缺失情况
- **倍数**: 1.0
- **最终得分范围**: 0.0 - 1.0

## 📈 实际得分分布示例

### 完美匹配情况
```
BGE得分: 1.0
CrossEncoder得分: 1.0
Fuzz得分: 1.0
Levenshtein得分: 1.0

加权得分: 1.0×0.4 + 1.0×0.3 + 1.0×0.2 + 1.0×0.1 = 1.0

类型匹配最终得分: 1.0 × 1.1 = 1.1
类型不匹配最终得分: 1.0 × 0.3 = 0.3
```

### 中等匹配情况
```
BGE得分: 0.7
CrossEncoder得分: 0.6
Fuzz得分: 0.5
Levenshtein得分: 0.4

加权得分: 0.7×0.4 + 0.6×0.3 + 0.5×0.2 + 0.4×0.1 = 0.62

类型匹配最终得分: 0.62 × 1.1 = 0.682
类型不匹配最终得分: 0.62 × 0.3 = 0.186
```

### 低匹配情况
```
BGE得分: 0.3
CrossEncoder得分: 0.2
Fuzz得分: 0.1
Levenshtein得分: 0.0

加权得分: 0.3×0.4 + 0.2×0.3 + 0.1×0.2 + 0.0×0.1 = 0.2

类型匹配最终得分: 0.2 × 1.1 = 0.22
类型不匹配最终得分: 0.2 × 0.3 = 0.06
```

## 🎯 决策阈值分析

### 当前配置
- **高阈值**: 1.0 (直接合并)
- **低阈值**: 0.5 (直接新建)

### 阈值影响分析

#### 类型匹配情况
- **高阈值1.0**: 需要加权得分 ≥ 0.91 (1.0/1.1)
- **低阈值0.5**: 需要加权得分 ≥ 0.45 (0.5/1.1)

#### 类型不匹配情况
- **高阈值1.0**: 需要加权得分 ≥ 3.33 (1.0/0.3) - **不可能达到**
- **低阈值0.5**: 需要加权得分 ≥ 1.67 (0.5/0.3) - **不可能达到**

#### 类型信息缺失情况
- **高阈值1.0**: 需要加权得分 ≥ 1.0
- **低阈值0.5**: 需要加权得分 ≥ 0.5

## 📊 得分分布统计

### 各模型得分特点

| 模型 | 得分范围 | 特点 | 适用场景 |
|------|----------|------|----------|
| BGE | 0.0-1.0 | 语义相似度，最核心 | 语义匹配 |
| CrossEncoder | 0.0-1.0 | 精确匹配，高质量 | 精确语义匹配 |
| Fuzz | 0.0-1.0 | 字符串相似度 | 名称/别名匹配 |
| Levenshtein | 0.0-1.0 | 字符级相似度 | 拼写变体 |

### 总分分布特点

| 情况 | 得分范围 | 决策倾向 | 说明 |
|------|----------|----------|------|
| 类型匹配 | 0.0-1.1 | 容易合并 | 同类型实体获得奖励 |
| 类型不匹配 | 0.0-0.3 | 容易新建 | 跨类型实体受到惩罚 |
| 类型缺失 | 0.0-1.0 | 中性 | 无类型信息时正常处理 |

## 🔧 配置建议

### 当前配置分析
- **类型不匹配惩罚过重**: 0.1倍导致跨类型匹配几乎不可能
- **建议调整**: 将 `TYPE_MISMATCH_PENALTY` 调整为 0.3-0.5

### 优化建议
```python
# 更合理的配置
TYPE_MISMATCH_PENALTY: float = 0.3  # 降低70%而不是90%
TYPE_MATCH_BONUS: float = 1.1       # 提升10%

# 阈值调整
HIGH_THRESHOLD: float = 0.85        # 降低高阈值
LOW_THRESHOLD: float = 0.3          # 降低低阈值
```

## ✅ 总结

1. **各模型得分范围**: 都是 0.0-1.0
2. **加权得分范围**: 0.0-1.0
3. **最终得分范围**: 
   - 类型匹配: 0.0-1.1
   - 类型不匹配: 0.0-0.3 (当前配置)
   - 类型缺失: 0.0-1.0
4. **当前配置问题**: 类型不匹配惩罚过重，建议调整 